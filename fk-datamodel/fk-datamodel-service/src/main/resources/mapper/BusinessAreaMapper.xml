<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fisk.datamodel.mapper.BusinessAreaMapper">
    <select id="queryList" resultType="com.fisk.datamodel.dto.BusinessPageResultDTO">
        SELECT
        id,
        business_name,
        business_email,
        business_des,
        business_admin,
        create_time,
        ((select count(*) from tb_dimension dim where dim.del_flag=1 and dim.business_id=business.id) +
        (select count(*) from tb_fact fact where fact.del_flag=1 and fact.business_id=business.id)) as modelNumber,
        ((select count(*) from tb_dimension dim where dim.del_flag=1 and dim.business_id=business.id and dim.is_publish=1) +
        (select count(*) from tb_fact fact where fact.del_flag=1 and fact.business_id=business.id and fact.is_publish=1)) as numberPositionPublishNumber,
        ((select count(*) from tb_dimension dim where dim.del_flag=1 and dim.business_id=business.id and dim.doris_publish=1) +
        (select count(*) from tb_fact fact where fact.del_flag=1 and fact.business_id=business.id and fact.doris_publish=1)) as analysisPublishNumber
        from tb_area_business as business
        where del_flag=1
        <if test="query.where !=null and query.where.length()>0 ">
            ${query.where}
        </if>
    </select>
</mapper>