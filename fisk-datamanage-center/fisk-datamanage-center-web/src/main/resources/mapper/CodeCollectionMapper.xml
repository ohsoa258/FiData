<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fisk.datamanagement.mapper.CodeCollectionMapper">

    <resultMap id="codeCollection" type="com.fisk.datamanagement.vo.CodeCollectionVO">
        <result column="collection_id" property="collectionId"/>
        <result column="collection_name" property="collectionName"/>
        <collection property="codeSetVOList" ofType="com.fisk.datamanagement.vo.CodeSetVO"/>
    </resultMap>
    <resultMap id="codeSetVOList" type="com.fisk.datamanagement.vo.CodeSetVO">
        <result property="id" column="id"/>
        <result column="code" property="code"/>
        <result column="name" property="name"/>
        <result column="description" property="description"/>
        <result column="createTime" property="createTime"/>
        <result column="createUser" property="createUser"/>
    </resultMap>
    <select id="getAllCodeCollectionCount" resultType="Integer">
        select count(1) from tb_code_collection
    </select>
    <select id="getCodeCollection" resultType="com.fisk.datamanagement.vo.CodeCollectionVO">
        SELECT
            c1.id AS collectionId,
            c1.collection_name,
            c2.id,
            c2.`code`,
            c2.`name`,
            c2.description,
            c2.create_time,
            c2.create_user
        FROM
        ( SELECT * FROM tb_code_collection c1 LIMIT #{startIndex},#{pageSize}) AS c1
            LEFT JOIN tb_code_set c2 ON c1.id = c2.collection_id
        <if test="keyword !=null and keyword.length()>0 ">
            and (c2.`code` like concat('%', #{keyword}, '%')
            or c2.`name` like concat('%', #{keyword}, '%')
            or c2.description like concat('%', #{keyword}, '%'))
        </if>
    </select>
</mapper>